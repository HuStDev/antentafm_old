<IfModule mod_ssl.c>
<VirtualHost *:443>
	ServerAdmin hust@earth
	ServerName login.antentafm.ddnss.de

	LogLevel info
	ErrorLog /var/log/login.hust-chat.com_error.log
	TransferLog /var/log/login.hust-chat.com_access.log

	SSLEngine On
	SSLCertificateFile /etc/letsencrypt/live/antentafm.ddnss.de/fullchain.pem
	SSLCertificateKeyFile /etc/letsencrypt/live/antentafm.ddnss.de/privkey.pem
	SSLCertificateChainFile /etc/letsencrypt/live/antentafm.ddnss.de/chain.pem

	<Location />
		Require all granted
	</Location>

	RewriteEngine On
	RewriteCond %{HTTP:Upgrade} =websocket [NC] 
	RewriteRule /(.*) ws://localhost:3030/$1 [P,L]
	RewriteCond %{HTTP:Upgrade} !=websocket [NC] 
	RewriteRule /(.*) http://localhost:3030/$1 [P,L]
	
	RewriteCond %{HTTP:Authorization} ^(.*)
	RewriteRule .* - [e=HTTP_AUTHORIZATION:%1]

	ProxyPassReverse / http://localhost:3030/
</VirtualHost>
</IfModule>
