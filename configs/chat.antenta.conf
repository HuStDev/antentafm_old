<VirtualHost *:80>
        ServerAdmin hust@earth
        ServerName chat.antentafm.ddnss.de

        <Location />
                Require all granted
        </Location>

        RewriteEngine On
        RewriteCond %{SERVER_NAME} =chat.antentafm.ddnss.de
        RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<IfModule mod_ssl.c>
<VirtualHost *:443>
	ServerAdmin hust@earth
	ServerName chat.antentafm.ddnss.de

	LogLevel info
	ErrorLog /var/log/chat.hust-chat.com_error.log
	TransferLog /var/log/chat.hust-chat.com_access.log

	SSLEngine On	
	SSLCertificateFile /etc/letsencrypt/live/antentafm.ddnss.de/fullchain.pem
	SSLCertificateKeyFile /etc/letsencrypt/live/antentafm.ddnss.de/privkey.pem
	SSLCertificateChainFile /etc/letsencrypt/live/antentafm.ddnss.de/chain.pem

	<Location />
		Require all granted
	</Location>

	RewriteEngine On
	RewriteCond %{HTTP:Upgrade} =websocket [NC]
	RewriteRule /(.*)           ws://localhost:3000/$1 [P,L]
	RewriteCond %{HTTP:Upgrade} !=websocket [NC]
	RewriteRule /(.*)           http://localhost:3000/$1 [P,L]

	RewriteCond %{HTTP:Authorization} ^(.*)
	RewriteRule .* - [e=HTTP_AUTHORIZATION:%1]

	ProxyPassReverse /          http://localhost:3000/
</VirtualHost>
</IfModule>
